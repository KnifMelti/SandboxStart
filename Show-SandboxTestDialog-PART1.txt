# This will be a large file - creating in parts then combining
# Part 1: Header and Default Scripts

<#
.SYNOPSIS
    Windows Sandbox Test Configuration Dialog

.DESCRIPTION
    Provides a GUI dialog for configuring Windows Sandbox test parameters.
    Includes folder/file selection, script mapping, and WinGet version selection.
#>

# Load required assemblies
Add-Type -AssemblyName System.Windows.Forms
Add-Type -AssemblyName System.Drawing

function Show-SandboxTestDialog {
    <#
    .SYNOPSIS
    Shows a GUI dialog for configuring Windows Sandbox test parameters

    .DESCRIPTION
    Creates a Windows Forms dialog to collect all parameters needed for SandboxTest function
    
    .OUTPUTS
    Hashtable with configuration parameters or $null if cancelled
    #>

    [CmdletBinding()]
    [OutputType([hashtable])]
    param()

    try {
        # Define default scripts array (no -f formatting; inject folder via regex replace)
        $defaultScripts = @{
            "InstallWSB" = @'
$SandboxFolderName = "DefaultFolder"
Start-Process cmd.exe -ArgumentList "/c del /Q `"$env:USERPROFILE\Desktop\$SandboxFolderName\*.log`" & `"$env:USERPROFILE\Desktop\$SandboxFolderName\InstallWSB.cmd`" && explorer `"$env:USERPROFILE\Desktop\$SandboxFolderName`""
'@
            "WinGetManifest" = @'
$SandboxFolderName = "DefaultFolder"
Start-Process cmd.exe -ArgumentList "/k cd /d `"$env:USERPROFILE\Desktop\$SandboxFolderName`" && winget install --manifest . --accept-source-agreements --accept-package-agreements"
'@
            "Installer" = @'
$SandboxFolderName = "DefaultFolder"
$sandboxPath = "$env:USERPROFILE\Desktop\$SandboxFolderName"

# Look for installer files (priority order)
$installers = @(
    "Install.cmd","install.cmd","INSTALL.CMD",
    "Install.bat","install.bat","INSTALL.BAT",
    "Setup.exe","setup.exe","SETUP.EXE",
    "Install.exe","install.exe","INSTALL.EXE",
    "Installer.exe","installer.exe","INSTALLER.EXE"
)
$found = $null
foreach ($file in $installers) {
    $path = Join-Path $sandboxPath $file
    if (Test-Path $path) { $found = $file; break }
}

if ($found) {
    if ($found -like "*.cmd" -or $found -like "*.bat") {
        Start-Process cmd.exe -ArgumentList "/c cd /d `"$sandboxPath`" && `"$found`""
    } else {
        Start-Process "$sandboxPath\$found" -WorkingDirectory $sandboxPath
    }
} else {
    Start-Process explorer.exe -ArgumentList "`"$sandboxPath`""
}
'@
            "Explorer" = @'
$SandboxFolderName = "DefaultFolder"
Start-Process explorer.exe -ArgumentList "`"$env:USERPROFILE\Desktop\$SandboxFolderName`""
'@
        }
